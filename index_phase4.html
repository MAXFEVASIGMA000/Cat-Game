
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Walk the Cat - Phase 4</title>
  <style>
    html, body { margin: 0; padding: 0; background: #111; overflow: hidden; }
    canvas { display: block; margin: auto; background: #66ccff; }
    #shopUI, #shadyUI {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      font-family: monospace;
      display: none;
    }
    button {
      font-family: monospace;
      margin: 4px 0;
      width: 100%;
    }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<div id="shopUI">
  <b>Cat Shop</b><br>
  <button onclick="buyCat('rainbow', 50)">Buy Rainbow Cat ($50)</button>
  <button onclick="buyCat('loaf', 110)">Buy Loaf Cat ($110)</button>
  <button onclick="buyCat('god', 200)">Buy God Cat ($200)</button>
  <button onclick="closeShop()">Close</button>
</div>
<div id="shadyUI">
  <b>Shady Cat</b><br>
  <button onclick="gamble()">Gamble (10 Kitty Cash)</button>
  <button onclick="closeShady()">Leave</button>
</div>

<script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");

  const groundY = 500;
  let playerX = 100;
  let playerY = groundY - 48;
  let kittyCash = 0;
  let level = 1;
  let inBossBattle = false;
  let bossHealth = 100;

  let unlockedCats = ["normal"];
  let shadyAvailable = false;

  const keys = {};
  document.addEventListener("keydown", e => keys[e.key] = true);
  document.addEventListener("keyup", e => keys[e.key] = false);

  const catSprite = new Image();
  catSprite.src = "https://i.imgur.com/n0U1NfL.png";
  const houseSprite = new Image();
  houseSprite.src = "https://i.imgur.com/bKpG2lw.png";
  const bossSprite = new Image();
  bossSprite.src = "https://i.imgur.com/tFUdT3O.png";

  function drawBackground() {
    ctx.fillStyle = "#66ccff";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "#2e8b57";
    ctx.fillRect(0, groundY, canvas.width, 100);
    ctx.fillStyle = "#cccccc";
    ctx.fillRect(0, groundY - 20, canvas.width, 20);
    ctx.drawImage(houseSprite, 600, groundY - 120, 120, 120);
  }

  function drawCat() {
    ctx.drawImage(catSprite, playerX, playerY, 48, 48);
  }

  function drawLeash() {
    ctx.strokeStyle = "#333";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(playerX + 20, playerY + 20);
    ctx.lineTo(playerX - 40, playerY + 10);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(playerX - 40, playerY + 10, 6, 0, Math.PI * 2);
    ctx.fillStyle = "#555";
    ctx.fill();
  }

  function drawUI() {
    ctx.fillStyle = "#000";
    ctx.font = "20px Courier New";
    ctx.fillText("Kitty Cash: $" + kittyCash, 20, 30);
    ctx.fillText("Level: " + level, 20, 60);
    if (inBossBattle) {
      ctx.fillText("Boss HP: " + bossHealth, 20, 90);
    }
  }

  function drawBoss() {
    ctx.drawImage(bossSprite, 600, groundY - 120, 96, 96);
  }

  function updateGame() {
    if (inBossBattle) {
      if (keys[" "]) {
        bossHealth -= getCatPower();
        keys[" "] = false;
        kittyCash += 10;
      }
      if (bossHealth <= 0) {
        inBossBattle = false;
        level++;
        bossHealth = 100 + level * 10;
        shadyAvailable = (level >= 3);
        alert("Boss defeated! Level up!");
      }
    } else {
      if (keys["ArrowRight"]) {
        playerX += 4;
        kittyCash += 1;
      }
      if (keys["ArrowLeft"]) {
        playerX -= 4;
        kittyCash = Math.max(0, kittyCash - 1);
      }
      if (playerX >= canvas.width - 100) {
        playerX = 100;
        inBossBattle = true;
        alert("Boss appears! Press SPACE to attack.");
      }
      if (keys["s"]) {
        openShop();
        keys["s"] = false;
      }
      if (keys["d"] && shadyAvailable) {
        openShady();
        keys["d"] = false;
      }
    }
  }

  function getCatPower() {
    if (unlockedCats.includes("god")) return 25;
    if (unlockedCats.includes("loaf")) return 10;
    if (unlockedCats.includes("rainbow")) return 7;
    return 3;
  }

  function buyCat(type, cost) {
    if (kittyCash >= cost && !unlockedCats.includes(type)) {
      kittyCash -= cost;
      unlockedCats.push(type);
      alert(type.charAt(0).toUpperCase() + type.slice(1) + " Cat unlocked!");
    } else {
      alert("Not enough Kitty Cash or already unlocked.");
    }
  }

  function gamble() {
    if (kittyCash >= 10) {
      kittyCash -= 10;
      const win = Math.random() > 0.5;
      if (win) {
        alert("ðŸŽ‰ Shady Cat healed you and boosted your power!");
        bossHealth -= 20;
      } else {
        alert("Let's go gambling... aw dang it... aw dang it... aw dang it...");
      }
    } else {
      alert("Not enough Kitty Cash to gamble.");
    }
  }

  function openShop() {
    document.getElementById("shopUI").style.display = "block";
  }

  function closeShop() {
    document.getElementById("shopUI").style.display = "none";
  }

  function openShady() {
    document.getElementById("shadyUI").style.display = "block";
  }

  function closeShady() {
    document.getElementById("shadyUI").style.display = "none";
  }

  function draw() {
    drawBackground();
    drawCat();
    drawLeash();
    if (inBossBattle) drawBoss();
    drawUI();
  }

  function gameLoop() {
    updateGame();
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    draw();
    requestAnimationFrame(gameLoop);
  }

  gameLoop();
</script>
</body>
</html>
